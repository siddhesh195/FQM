{% extends "base.html" %}
{% block title %} FQM - {{ page_title }} {% endblock %}


{%- from "sb_manage.html" import sb_manage with context %}
{% block sidebar %}
 {{ sb_manage() }}
{% endblock %}

{% block page_content %}
<div id="app" class="container" style="margin-top: 20px;" v-cloak>

    <table class="table table-bordered table-striped table-sm">
        <thead>
            <tr>
                <th v-for="col in columns" :key="col.label">
                    [[ col.label ]]
                </th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="row in paginatedRows" :key="row.id || row.name + '-' + row.number">
                <td>[[ row.name ]]</td>
                <td>[[ row.number ]]</td>
                <td>[[ row.office_name ]]</td>
                <td>[[ row.task_name ]]</td>
                <td>[[ row.status ]]</td>
                <td>[[ row.pulled_by ]]</td>
                <td>[[ row.pulled ? 'Yes' : 'No' ]]</td>
                <td>[[ row.timestamp ]]</td>
            </tr>
            <tr v-if="paginatedRows.length === 0">
                <td :colspan="columns.length" class="text-center">
                    No data
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Pagination controls -->
    <nav aria-label="Page navigation" class="d-flex justify-content-between align-items-center">
        <div>
            Page [[ currentPage ]] of [[ totalPages ]]
        </div>

        <ul class="pagination mb-0">
            <li class="page-item" :class="{ disabled: currentPage === 1 }">
                <button class="page-link" @click="prevPage" :disabled="currentPage === 1">
                    Prev
                </button>
            </li>

            <li
                class="page-item"
                v-for="page in totalPages"
                :key="page"
                :class="{ active: page === currentPage }"
            >
                <button class="page-link" @click="goToPage(page)">
                    [[ page ]]
                </button>
            </li>

            <li class="page-item" :class="{ disabled: currentPage === totalPages }">
                <button class="page-link" @click="nextPage" :disabled="currentPage === totalPages">
                    Next
                </button>
            </li>
        </ul>
    </nav>

 
</div>
{% endblock %}


{% block scripts %}

<script type="module">

    import { createApp, markRaw } from "{{ url_for('static', filename='vendor/vue/vue.esm-browser.prod.js') }}";


    const app =createApp({
        delimiters: ['[[', ']]'],
    
        data() {
            return {
                rows: [],
                columns: [
                    { label: 'Token Name'},
                    { label: 'Number'},
                    { label: 'Office'},
                    { label: 'Task'},
                    { label: 'Status'},
                    { label: 'Pulled By'},
                    { label: 'Pulled?'},
                    { label: 'Time'},
                ],
                // pagination
                currentPage: 1,
                perPage: 10,   // change as you like
            };
        },

        methods: {
            fetchData() {
                axios.get("{{ url_for('offices.all_offices_tickets') }}")
                    .then(response => {
                        this.rows = response.data;
                       
                    })
                    .catch(error => {
                        console.error("Error fetching data:", error);
                    });      
            },

            goToPage(page) {
                if (page < 1 || page > this.totalPages) return;
                this.currentPage = page;
            },

            nextPage() {
                this.goToPage(this.currentPage + 1);
            },

            prevPage() {
                this.goToPage(this.currentPage - 1);
            }
           
        },

        computed:{

            totalPages() {
                return this.rows.length === 0
                    ? 1
                    : Math.ceil(this.rows.length / this.perPage);
            },

            paginatedRows() {
                const start = (this.currentPage - 1) * this.perPage;
                const end   = start + this.perPage;
                return this.rows.slice(start, end);
            }
        },
        
        mounted() {
            this.fetchData();
            this.intervalId = setInterval(this.fetchData, 2000)
        },
        beforeUnmount() {
            clearInterval(this.intervalId);
        }
    });
   
    app.mount('#app');
   
</script>

{% endblock %}
