<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this
   - file, You can obtain one at http://mozilla.org/MPL/2.0/. -->

{% extends "base.html" %}
{% block title %} FQM - {{ page_title  }} {% endblock %}

{%- from "sb_manage2.html" import sb_manage with context %}
{% block sidebar %}
{{ sb_manage() }}
{% endblock %}

{% block page_content %}
{% from "_helpers.html" import render_field with context %}
{% from "_modals.html" import qrModal %}
<div class="col-md-12">
    <form method="POST" enctype="multipart/form-data" id="fm">
		<div class="panel panel-default">
	    	<div class="panel-heading text-center">
				<h3 class="text-muted ar1">
		    		<strong>
						<span class="fa fa-plus"></span>
						  {{ translate('Add new office', 'en', [defLang]) }}
		    		</strong>
				</h3>
	    	</div>
	    	<div class="panel-body">
				{{ form.csrf_token }}
				<a data-toggle="modal" data-target="#mym">
		    		<center><img class="img-responsive img-thumbnail mt-4 mb-2" id="map" width="40%" src="{{ url_for('static', filename='images/manage_office.jpg') }}"></center>
				</a>
				<p class="h3 text-center text-muted ar2">
				    | {{ translate("Office : the virtual representation of an office on-which tickets are pulled and managed", 'en', [defLang]) }} |
				</p>
				<hr>
                <div >
				{{ render_field(form.name, class="form-control", **{'v-model': 'office_name', 'length': 60}) }}
				</div>
				{{ render_field(form.prefix, class="form-control", **{'v-model': 'office_prefix'}) }}
				<p class="pb-5"></p>
				<center>
		    		<button @click="addOffice" type="button"  class="btn btn-md btn-danger"> {{ translate('Add office', 'en', [defLang]) }}</button>
				</center>
    			<p class="pb-2"></p>
	    	</div>
		</div>
    </form>
</div>
{{ qrModal([['mym', translate('Management template', 'en', [defLang]), url_for('static', filename='images/manage_map.jpg')]], close=translate('Exit', 'en', [defLang]))}}
{% endblock %}

{% block vue_data %}
office_name: '',
office_prefix: '',
csrf_token:  "{% if form and form.csrf_token is defined %}{{ form.csrf_token._value() }}{% endif %}",
add_office_url: "{{ url_for('offices.add_office') }}"

{% endblock %}

{% block vue_methods %}
async addOffice() {
    try {
        const response = await axios.post(this.add_office_url, {
            name: this.office_name,
            prefix: this.office_prefix,
            csrf_token: this.csrf_token
        });

        if (response.data.status === 'success') {
            const result = await showSwalMessage(response.data.message);

            if (result.isConfirmed) {
                window.location.reload();
            }

            this.office_name = '';
            this.office_prefix = '';
        } else {
            await showSwalMessage(response.data.message);
        }

    } catch (error) {
        console.error(error);
        await showSwalMessage('An unexpected error occurred.');
    }
}


{% endblock %}



{% block vue_mounted %}


{% endblock %}

{% block  vue_watch %}



{% endblock %}
